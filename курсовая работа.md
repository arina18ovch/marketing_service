<p align="center">Министерство образования, науки и молодежной политики Республики Коми</p>

<p align="center">ГПОУ "Сыктывкарский политехнический техникум"</p>






<p align="center">Курсовая работа</p>



<p align="center">Тема: База данных Издательства. Подсистема служба маркетинга</p>















<p align="right"> выполнил </p>

<p align="right">студент 4 курса </p>

<p align="right">414 группы </p>

<p align="right">Овчинникова Арина Игоревна</p>



<p align="right">проверил</p>

<p align="right">Пунгин И.В.</p>

<p align="right">дата проверки: ______________</p>










<p align="center">Сыктывкар, 2025</p>






# Задание на курсовую работу по МДК 11.01 "Технология разработки и защиты баз данных"

Специальность: <ins> 09.02.07 "Информационные системы и программирование"  </ins>

Тема курсовой работы:База данных Издательства. Подсистема служба маркетинга

Срок представления работы к защите: <ins> ... марта 2025 года. </ins>

Перечень подлежащих разработке вопросов:

1. Анализ предметной области. Постановка задачи.

    1.1. Описание предметной области и функции решаемых задач.

    1.2. Перечень входных данных.

    1.3. Перечень выходных данных

    1.4. Ограничения предметной области (если таковые имеются).

    1.5. Взаимодействие с другими программами.

3. Инфологическая (концептуальная) модель базы данных.

    2.1. Выделение информационных объектов.

    2.2. Определение атрибутов объектов.

    2.3. Определение отношений и мощности отношений между объектами.

    2.4. Построение концептуальной модели.

4. Логическая структура БД.

5. Физическая структура базы данных.

6. Реализация проекта в среде конкретной СУБД.

    6.1. Создание таблиц и индексов.

    6.2. Создание представлений и функций.

    5.3. Разработка интерфейса.

    5.4. Назначение прав доступа.

    5.5. Разработка стратегии резервного копирования базы данных.


Руководитель работы __________________ <ins> И. В. Пунгин </ins>

Задание принял к исполнению _______________________________ <ins> А.И. Овчинникова </ins>




## <a id="content">Содержание</a>

1. [Введение](#introduction)
    - [Цель работы](#target)
    - [Задачи работы](#tasks)
2. [Основная часть](#main)
    - [Анализ предметной области. Постановка задачи](#analysis)
    - [Инфологическая (концептуальная) модель базы данных](#infological_model)
    - [Логическая структура БД](#logical_structure)
    - [Физическая структура базы данных](#physical_structure)
    - [Реализация проекта в среде конкретной СУБД](#project_realization)
3. [Заключение](#conclusion)
4. [Список использованных информационных источников](#literature)
5. [Приложения](#applications)

book_authors

## <a id="introduction">Введение</a>  

В условиях цифровой трансформации издательского бизнеса эффективное управление маркетинговыми процессами становится ключевым фактором конкурентоспособности. Автоматизация анализа потребительского спроса, оптимизация рекламных бюджетов и контроль эффективности кампаний требуют внедрения специализированной базы данных (БД), что обуславливает актуальность разработки подсистемы маркетинга для издательства. Такая система должна обеспечивать централизованное хранение данных о маркетинговых активностях, включая рекламные кампании, материалы (баннеры, email-рассылки), взаимодействие с клиентами, а также интеграцию с данными о продажах и авторах.  

Внедрение автоматизированной базы данных позволит:  
- Сократить время на ручной учёт и анализ данных.  
- Минимизировать ошибки при планировании бюджета кампаний.  
- Оперативно оценивать ROI (возврат на инвестиции) для каждого рекламного канала.  
- Персонализировать взаимодействие с клиентами на основе их предпочтений и истории покупок.  

Ключевая задача проекта — создание системы, которая объединит данные о маркетинговых кампаниях, материалах, заказах и клиентах, обеспечив:  
- Автоматическое обновление остатков книг на складе при запуске рекламных акций.  
- Формирование отчётов по конверсии, динамике спроса и эффективности каналов продвижения.  
- Интеграцию с CRM-системами для анализа лояльности клиентов.  
- Защиту конфиденциальных данных (бюджеты, контакты авторов) через ролевую модель доступа.  

Разработанная подсистема станет инструментом для:  
- Прогнозирования спроса на книги с использованием исторических данных.  
- Оптимизации рекламных бюджетов за счёт анализа ROI.  
- Ускорения вывода новых изданий на рынок благодаря автоматизации процессов.  

Таким образом, курсовая работа направлена на создание базы данных, которая не только автоматизирует текущие задачи маркетинговой службы издательства, но и станет основой для внедрения AI-решений в будущем, таких как прогнозирование трендов или генерация персональных рекомендаций для клиентов.


## <a id="target">Цель работы</a>  

**Целью курсовой работы** является разработка базы данных для подсистемы маркетинга издательства, которая обеспечит автоматизацию процессов планирования, анализа и оптимизации маркетинговых активностей. В рамках работы предполагается:  

1. **Создание структуры базы данных**:  
   Разработать схему БД, отражающую ключевые сущности маркетинговой деятельности издательства: рекламные кампании, маркетинговые материалы (баннеры, email-рассылки), данные о клиентах, заказах и авторах. Обеспечить целостность данных за счёт нормализации таблиц, установки связей (например, между кампаниями и материалами) и ограничений (проверка бюджетов, дат).  

2. **Реализация функционала для управления маркетинговыми процессами**:  
   Создать механизмы для:  
   - Регистрации новых кампаний с привязкой к материалам и авторам.  
   - Учёта затрат на рекламу и анализа ROI (возврата на инвестиции).  
   - Автоматического обновления данных о продажах при запуске акций.  

3. **Разработка аналитических инструментов**:  
   Реализовать представления и запросы для:  
   - Анализа эффективности кампаний по ключевым метрикам (конверсия, охват, CTR).  
   - Формирования отчётов по динамике спроса на книги в разрезе жанров и авторов.  
   - Прогнозирования потребности в тиражах на основе исторических данных.  

4. **Обеспечение безопасности и ролевого доступа**:  
   Внедрить модель разграничения прав:  
   - **Маркетологи** — управление кампаниями и материалами.  
   - **Администраторы** — полный контроль над данными, включая настройку прав.  
   - **Клиенты** — доступ к персонализированным предложениям через внешние интерфейсы.  
   Защитить конфиденциальные данные (бюджеты, контакты авторов) через шифрование и аудит изменений.  

5. **Интеграция с внешними системами**:  
   Настроить взаимодействие с CRM-системами для анализа лояльности клиентов и электронными торговыми площадками для автоматического обновления остатков книг.  

6. **Документирование системы**:  
   Подготовить:  
   - Техническую документацию (ER-диаграммы, описание таблиц, SQL-скрипты).  
   - Руководство пользователя для маркетологов с примерами работы (создание кампаний, анализ ROI).  
   - API-документацию для интеграции с платформами электронной коммерции.  

**Итоговая цель** — создание системы, которая не только автоматизирует текущие задачи маркетинговой службы, но и станет основой для:  
- Оптимизации рекламных бюджетов за счёт анализа данных в реальном времени.  
- Персонализации взаимодействия с клиентами через сегментацию аудитории.  
- Внедрения AI-решений для прогнозирования спроса и генерации контента.  

Таким образом, разработанная база данных позволит издательству повысить эффективность маркетинговых стратегий, сократить издержки и укрепить позиции на конкурентном рынке.


## <a id="analysis">Анализ предметной области. Постановка задачи</a>  

### 1. **Описание предметной области и функции решаемых задач**  
   - **Предметная область** данной работы — управление маркетинговой деятельностью издательства, включая планирование рекламных кампаний, создание маркетинговых материалов (баннеры, email-рассылки, соцсети), анализ эффективности продвижения книг и взаимодействие с клиентами. Система направлена на автоматизацию процессов, связанных с продвижением изданий, что позволит оптимизировать рекламные бюджеты, повысить конверсию и улучшить взаимодействие с целевой аудиторией. Основная цель — увеличение продаж за счёт точного таргетинга, анализа данных о спросе и оперативного управления кампаниями.  
   - **Функции решаемых задач:**  
     - **Управление маркетинговыми кампаниями:**  
       - Создание и редактирование кампаний с указанием бюджета, сроков, целевой аудитории.  
       - Привязка материалов (баннеры, видео, тексты) к конкретным кампаниям.  
     - **Анализ эффективности:**  
       - Расчёт метрик: ROI (возврат на инвестиции), CTR (кликабельность), конверсия в продажи.  
       - Формирование отчётов по эффективности каналов продвижения (соцсети, email, сайт).  
     - **Взаимодействие с клиентами:**  
       - Сегментация аудитории на основе предпочтений (жанры книг, история покупок).  
       - Автоматизация персонализированных рассылок и рекомендаций.  
     - **Интеграция с данными о книгах и авторах:**  
       - Учёт информации о книгах (жанр, тираж, дата публикации) и авторах (контакты, участие в промо-акциях).  
       - Связь кампаний с конкретными изданиями или авторами.  
     - **Контроль бюджета:**  
       - Мониторинг расходов на рекламу в реальном времени.  
       - Автоматические предупреждения о превышении лимитов.  
     - **Разграничение прав доступа:**  
       - *Администратор* — полный контроль над данными, настройка ролей, доступ к финансовой аналитике.  
       - *Маркетолог* — создание и управление кампаниями, просмотр метрик.  
       - *Клиент* — доступ к персонализированным предложениям и истории заказов.  

### 2. **Постановка задачи**  
Разработать базу данных и приложение, которые:  
- Автоматизируют учёт маркетинговых активностей от планирования до анализа результатов.  
- Обеспечивают целостность данных через:  
  - Уникальность идентификаторов кампаний и материалов.  
  - Проверку корректности дат (окончание кампании не раньше начала).  
  - Контроль бюджета (запрет отрицательных значений, лимиты расходов).  
- Предоставляют инструменты для:  
  - Прогнозирования спроса на книги на основе исторических данных.  
  - Сравнения эффективности разных каналов продвижения (соцсети vs. email).  
- Интегрируются с внешними системами:  
  - Импорт данных о продажах из CRM.  
  - Экспорт метрик в Excel для формирования презентаций.  
- Поддерживают многопользовательскую работу:  
  - Параллельное редактирование кампаний с блокировкой конфликтующих изменений.  
  - Ролевая модель с разным уровнем доступа к финансовым и клиентским данным.  

**Пример реализации:**  
- Таблица `campaigns` хранит данные о рекламных активностях, включая бюджет, сроки и привязку к книгам.  
- Триггеры автоматически обновляют остатки бюджета при добавлении новых материалов.  
- Представление `campaign_performance` агрегирует данные по ROI и конверсии для каждой кампании.  
- Клиентский интерфейс позволяет фильтровать книги по жанрам и получать персонализированные рекомендации на основе истории покупок.  

Этот подход позволит издательству сократить время на ручные расчёты, повысить точность прогнозов и усилить вовлечённость аудитории.



## <a id="input">2. Перечень входных данных</a>  
Для корректной работы маркетинговой подсистемы издательства требуются следующие входные данные:  

---

### **Данные о маркетинговых кампаниях:**  
  - Идентификатор кампании (ID).  
  - Название кампании.  
  - Тип кампании (например, "Email-рассылка", "Соцсети", "Печатная реклама").  
  - Бюджет (в формате DECIMAL).  
  - Дата начала и окончания.  
  - Целевая аудитория (демография, предпочтения).  
  - Идентификатор ответственного маркетолога (внешний ключ к таблице `users`).  
  - Список привязанных книг/авторов (внешние ключи к таблицам `books` и `authors`).  

---

### **Данные о маркетинговых материалах:**  
  - Идентификатор материала (ID).  
  - Тип материала ("Баннер", "Видео", "Текст для рассылки", "Landing Page").  
  - Контент (URL изображения, текст, HTML-шаблон).  
  - Дата создания и публикации.  
  - Идентификатор кампании (внешний ключ к таблице `campaigns`).  
  - Статус ("Черновик", "Опубликован", "Архив").  

---

### **Данные о клиентах:**  
  - Идентификатор клиента (ID).  
  - Имя, фамилия, email, телефон.  
  - Предпочтения (любимые жанры книг, история покупок).  
  - Дата последнего взаимодействия.  
  - Сегмент аудитории ("Новый", "Постоянный", "Неактивный").  

---

### **Данные о книгах:**  
  - Идентификатор книги (ID).  
  - Название, жанр, дата публикации.  
  - Тираж, цена, текущий остаток на складе.  
  - Идентификатор автора (внешний ключ к таблице `authors`).  
  - Рейтинг продаж и отзывов.
    
---

### **Данные авторах:**  
  - Идентификатор автора (ID).  
  - Имя, фамилия, контактные данные.  
  - Биография, участие в промо-акциях.  
  - Список опубликованных книг (внешние ключи к таблице `books`).
    
---

### **Данные о книгах и авторах:**  
  - Идентификатор книги (ID).
  - Идентификатор автора (ID).
    
---

### **Данные о событиях (взаимодействия с клиентами):**  
  - Идентификатор события (ID).  
  - Тип события ("Покупка", "Подписка на рассылку", "Открытие email", "Клик по баннеру").  
  - Идентификатор клиента (внешний ключ к таблице `customers`).  
  - Идентификатор материала/кампании (внешние ключи к таблицам `marketing_materials` и `campaigns`).  
  - Дата и время события.  
  - Дополнительные метрики (например, длительность просмотра видео).  

---

### **Данные о пользователях системы:**  
  - Идентификатор пользователя (ID).  
  - Логин и хеш пароля (для авторизации).  
  - Роль ("Администратор", "Маркетолог", "Клиенты").  
  - Привязанные кампании (для роли "Маркетолог").  
  - Права доступа к финансовым отчётам (для роли "Клиенты").  

---

### **Данные для аналитики:**  
  - Ключевые метрики эффективности:  
    - ROI (Return on Investment).  
    - CTR (Click-Through Rate).  
    - Конверсия в продажи.  
  - Периодичность отчётов (ежедневно, еженедельно, ежемесячно).  
  - Пороговые значения для уведомлений (например, "CTR ниже 2%").  

---


Этот перечень обеспечивает полноту данных, необходимых для автоматизации маркетинговых процессов, анализа ROI и персонализации взаимодействия с аудиторией.

### <a id="output">3. Перечень выходных данных</a>  
На основе входных данных система предоставляет следующие выходные данные:  

---

#### **1. Отчёты по эффективности маркетинговых кампаний:**  
- **Анализ ROI (Return on Investment):**  
  - Сравнение затрат на кампанию с полученной выручкой.  
  - Рентабельность по каналам продвижения (соцсети, email, баннеры).  
- **Конверсия в продажи:**  
  - Процент клиентов, совершивших покупку после взаимодействия с материалом.  
  - Топ материалов с наивысшей конверсией.  
- **CTR (Click-Through Rate):**  
  - Статистика кликабельности для баннеров и email-рассылок.  
  - Сравнение CTR по разным сегментам аудитории.  

---

#### **2. Статистика по клиентскому поведению:**  
- **Сегментация аудитории:**  
  - Распределение клиентов по категориям: "Новые", "Постоянные", "Неактивные".  
  - Анализ предпочтений (любимые жанры книг, частота покупок).  
- **Динамика продаж:**  
  - Изменение спроса на книги в разрезе жанров и авторов.  
  - Сезонные тренды (например, рост продаж перед праздниками).  

---

#### **3. Отчёты по книгам и авторам:**  
- **Рейтинг продаж:**  
  - Топ-10 самых популярных книг за период.  
  - Сравнение продаж новых изданий с классикой.  
- **Эффективность промо-акций с участием авторов:**  
  - Влияние автограф-сессий или интервью на рост продаж.  
  - Анализ вовлечённости аудитории в мероприятиях.  

---

#### **4. Финансовые сводки:**  
- **Распределение бюджета:**  
  - Затраты на рекламу по каналам (соцсети, email, печать).  
  - Остаток бюджета в реальном времени с учётом текущих расходов.  
- **Прогнозы:**  
  - Рекомендации по оптимальному распределению бюджета на основе исторических данных.  

---

### <a id="limitations">4. Ограничения предметной области</a>  
При работе с системой необходимо учитывать следующие ограничения:  

1. **Ограничение по объёму данных:**  
   - Рост количества кампаний, материалов и клиентов может замедлить выполнение аналитических запросов. Для решения требуется:  
     - Партиционирование таблиц (например, по датам кампаний).  
     - Использование колоночных индексов для ускорения агрегации данных.  

2. **Ограничение по доступу:**  
   - Финансовые данные (бюджеты, ROI) и клиентские персональные данные (email, история покупок) защищены через ролевую модель:  
     - *Администратор* — полный доступ ко всем данным, включая финансовые отчёты.  
     - *Маркетолог* — доступ к своим кампаниям, материалам и обезличенной статистике.  
     - *Клиенты* — доступ только к персонализированным предложениям и истории своих заказов.  

3. **Ограничение по обновлению данных:**  
   - Для предотвращения потерь настроить:  
     - Ежедневное резервное копирование с хранением копий в облаке (AWS S3).  
     - Триггеры для аудита изменений (например, журнал правок в таблице `campaigns`).  

---

### <a id="integration">5. Взаимодействие с другими программами</a>  
Система интегрируется с внешними сервисами для расширения функциональности:  

1. **CRM-системы (например, Bitrix24, Salesforce):**  
   - Синхронизация данных о клиентах и истории покупок.  
   - Автоматический импорт контактов для email-рассылок.  

2. **Платформы аналитики (Power BI, Tableau):**  
   - Маркетологи могут визуализировать метрики эффективности кампаний через интерфейс системы.  
   - Администраторы управляют интеграцией и настройкой дашбордов.  

3. **Электронные торговые площадки (Amazon, Ozon):**  
   - Автоматическое обновление остатков книг на складе при запуске рекламных акций.  
   - Экспорт данных о продажах для анализа конверсии.  

4. **Инструменты автоматизации маркетинга (Mailchimp, SendPulse):**  
   - Маркетологи отправляют персонализированные рассылки через интеграцию.  
   - Треккинг открытий писем и кликов по ссылкам доступен в интерфейсе.  

5. **Социальные сети (Facebook, Instagram):**  
   - Маркетологи загружают баннеры и запускают таргетированную рекламу через API.  

6. **Системы прогнозирования спроса (на основе ML):**  
   - Администраторы настраивают интеграцию для анализа исторических данных.  
   - Прогнозы по тиражам отображаются в разделе для маркетологов.  

---

### Корректировки по ролевой модели:  
- **Администратор:** Полный доступ к данным, включая финансовые отчёты, интеграции и настройку прав.  
- **Маркетолог:** Управление кампаниями, анализ метрик (ROI, CTR), работа с материалами.  
- **Клиент:** Просмотр персонализированных предложений и истории заказов.  


## <a id="infological_model">Инфологическая (концептуальная) модель базы данных</a>  

Концептуальная модель описывает структуру данных для управления маркетинговой деятельностью издательства, включая ключевые сущности, их атрибуты и связи.  

---

### 1. **Выделение информационных объектов**  
- **Кампании (`campaigns`):**  
  Рекламные активности: название, бюджет, сроки, целевая аудитория.  
- **Маркетинговые материалы (`marketing_materials`):**  
  Контент для продвижения: баннеры, email-рассылки, видео.  
- **Книги (`books`):**  
  Издания, участвующие в кампаниях: название, жанр, цена, тираж.  
- **Авторы (`authors`):**  
  Создатели книг, участвующие в промо-акциях.  
- **Клиенты (`customers`):**  
  Покупатели, взаимодействующие с материалами и совершающие заказы.  
- **Заказы (`orders`):**  
  Информация о продажах книг: дата, сумма, количество.  
- **Пользователи (`users`):**  
  Участники системы с ролями: администратор, маркетолог, клиент.  
- **Маркетологи (`marketers`):**  
  Сотрудники, управляющие кампаниями (дополнение к `users`).  
- **Администраторы (`administrators`):**  
  Управление системой и правами (дополнение к `users`).  

---

### 2. **Определение атрибутов объектов**  

#### **Кампании (`campaigns`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `campaign_id`       | SERIAL          | Уникальный идентификатор         |  
| `campaign_name`     | VARCHAR(255)    | Название кампании                |  
| `start_date`        | DATE            | Дата начала                      |  
| `end_date`          | DATE            | Дата окончания                   |  
| `budget`            | NUMERIC(12,2)   | Бюджет кампании                  |  
| `target_audience`   | TEXT            | Описание целевой аудитории       |  
| `marketer_id`       | INTEGER         | Ответственный маркетолог         |  

#### **Маркетинговые материалы (`marketing_materials`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `material_id`       | SERIAL          | Уникальный идентификатор         |  
| `type`              | VARCHAR(50)     | Тип (баннер, email, видео)       |  
| `content`           | TEXT            | Ссылка или текст контента        |  
| `campaign_id`       | INTEGER         | Привязка к кампании              |  
| `creation_date`     | TIMESTAMP       | Дата создания                    |  

#### **Книги (`books`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `book_id`           | SERIAL          | Уникальный идентификатор         |  
| `title`             | VARCHAR(255)    | Название книги                   |  
| `genre`             | VARCHAR(100)    | Жанр                             |  
| `price`             | NUMERIC(10,2)   | Цена                             |  
| `stock`             | INTEGER         | Остаток на складе                |  
| `author_id`         | INTEGER         | Автор книги                      |  

#### **Авторы (`authors`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `author_id`         | SERIAL          | Уникальный идентификатор         |  
| `first_name`        | VARCHAR(100)    | Имя автора                       |  
| `last_name`         | VARCHAR(100)    | Фамилия автора                   |  
| `bio`               | TEXT            | Биография                        |  

#### **Клиенты (`customers`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `customer_id`       | SERIAL          | Уникальный идентификатор         |  
| `email`             | VARCHAR(255)    | Email                            |  
| `phone`             | VARCHAR(20)     | Телефон                          |  
| `preferred_genres`  | TEXT[]          | Любимые жанры книг               |  

#### **Книги и Авторы (`book_authors`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `author_id`         | SERIAL          | Уникальный идентификатор         |  
| `book_id`           | SERIAL          | Уникальный идентификатор         |

#### **Заказы (`orders`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `order_id`          | SERIAL          | Уникальный идентификатор         |  
| `customer_id`       | INTEGER         | Клиент                           |  
| `book_id`           | INTEGER         | Книга                            |  
| `quantity`          | INTEGER         | Количество                       |  
| `order_date`        | TIMESTAMP       | Дата заказа                      |  
| `total_price`       | NUMERIC(10,2)   | Сумма заказа                     |  

#### **Пользователи (`users`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `user_id`           | SERIAL          | Уникальный идентификатор         |  
| `username`          | VARCHAR(50)     | Логин                            |  
| `password_hash`     | VARCHAR(255)    | Хеш пароля                       |  
| `role`              | VARCHAR(20)     | Роль (admin, marketer, customer) |  

#### **Маркетологи (`marketers`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `marketer_id`       | SERIAL          | Уникальный идентификатор         |  
| `user_id`           | INTEGER         | Ссылка на пользователя           |  
| `department`        | VARCHAR(100)    | Отдел (Digital, SMM, SEO)        |  

#### **Администраторы (`administrators`)**  
| Атрибут            | Тип данных       | Описание                          |  
|---------------------|------------------|-----------------------------------|  
| `admin_id`          | SERIAL          | Уникальный идентификатор         |  
| `user_id`           | INTEGER         | Ссылка на пользователя           |  
| `access_level`      | VARCHAR(50)     | Уровень доступа (полный/частичный)|  

---

### 3. **Определение отношений**  
1. **Кампания → Материалы**  
   - Одна кампания включает **много** материалов (`1:N`).  
   - Связь: `campaigns.campaign_id` → `marketing_materials.campaign_id`.  

2. **Кампания → Маркетолог**  
   - Один маркетолог управляет **многими** кампаниями (`1:N`).  
   - Связь: `marketers.marketer_id` → `campaigns.marketer_id`.  

3. **Книга → Автор**  
   - Один автор пишет **много** книг (`1:N`).  
   - Связь: `authors.author_id` → `books.author_id`.  

4. **Клиент → Заказы**  
   - Один клиент совершает **много** заказов (`1:N`).  
   - Связь: `customers.customer_id` → `orders.customer_id`.  

5. **Заказ → Книга**  
   - Один заказ содержит **одну** книгу (`1:1`), но книга может быть в **многих** заказах (`1:N`).  
   - Связь: `books.book_id` → `orders.book_id`.  

6. **Пользователь → Роль**  
   - Пользователь имеет **одну** роль, но роль может быть у **многих** пользователей (`1:N`).  
   - Связь через поле `users.role`.
     
7. **Книги → Авторы**  
   - Тип связи: Многие ко многим (`M:N`).
   - Описание: одна книга может быть написана несколькими авторами, один автор может написать много книг
   - Связь через промежуточную таблицу`book_authors`.

---

### 4. **ER-диаграмма**  
![ER-диаграмма](![marketing_service - public]([[https://github.com/user-attachments/assets/b5f05378-aba4-43e5-88c1-22f6975bb9ec](https://github.com/arina18ovch/marketing_service/blob/main/%D0%BA%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%B0%D1%8F%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0.md)](https://github.com/arina18ovch/marketing_service/blob/main/marketing_service%20-%20public.png?raw=true))
)  
*Рисунок 1. Концептуальная модель для подсистемы маркетинга издательства.*  

---

### 5. **Ограничения целостности**  
- **Уникальность:**  
  - `users.username` — уникальный логин.  
  - `customers.email` — уникальный email клиента.  
- **Проверка значений:**  
  - `books.stock` не может быть отрицательным.  
  - `campaigns.end_date` не раньше `start_date`.  
- **Каскадное удаление:**  
  - Удаление кампании → удаление связанных материалов.  
  - Удаление автора → обнуление `author_id` в таблице `books`.  

---


## <a id="logical_structure">Логическая структура базы данных</a>  

Логическая структура базы данных для подсистемы маркетинга издательства включает следующие таблицы с атрибутами, типами данных, ключами и ограничениями:  

---

### **Таблица `users` (Пользователи)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `user_id`           | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `username`          | VARCHAR(50)     | Логин                            | UNIQUE, NOT NULL                |  
| `password_hash`     | VARCHAR(255)    | Хеш пароля                       | NOT NULL                        |  
| `role`              | VARCHAR(20)     | Роль: admin, marketer, customer  | CHECK (`role` IN ('admin', 'marketer', 'customer')) |  

---

### **Таблица `administrators` (Администраторы)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `admin_id`          | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `user_id`           | INTEGER         | Ссылка на пользователя           | FOREIGN KEY REFERENCES `users`  |  
| `access_level`      | VARCHAR(50)     | Уровень доступа                  | DEFAULT 'full'                  |  

---

### **Таблица `marketers` (Маркетологи)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `marketer_id`       | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `user_id`           | INTEGER         | Ссылка на пользователя           | FOREIGN KEY REFERENCES `users`  |  
| `department`        | VARCHAR(100)    | Отдел (Digital, SMM, SEO)        | NOT NULL                        |  

---

### **Таблица `customers` (Клиенты)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `customer_id`       | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `email`             | VARCHAR(255)    | Email                            | UNIQUE, NOT NULL                |  
| `phone`             | VARCHAR(20)     | Телефон                          |                                 |  
| `preferred_genres`  | TEXT[]          | Любимые жанры книг               |                                 |  

---

### **Таблица `authors` (Авторы)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `author_id`         | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `first_name`        | VARCHAR(100)    | Имя автора                       | NOT NULL                        |  
| `last_name`         | VARCHAR(100)    | Фамилия автора                   | NOT NULL                        |  
| `bio`               | TEXT            | Биография                        |                                 |  

---

### **Таблица `books` (Книги)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `book_id`           | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `title`             | VARCHAR(255)    | Название книги                   | NOT NULL                        |  
| `genre`             | VARCHAR(100)    | Жанр                             | NOT NULL                        |  
| `price`             | NUMERIC(10,2)   | Цена                             | CHECK (`price` > 0)            |  
| `stock`             | INTEGER         | Остаток на складе                | CHECK (`stock` >= 0)           |  
| `author_id`         | INTEGER         | Автор книги                      | FOREIGN KEY REFERENCES `authors` |  
### **Таблица `book_authors` (Книги и Авторы)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `author_id`         | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `book_id`           | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     | 

---

### **Таблица `campaigns` (Компании)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `campaign_id`       | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `campaign_name`     | VARCHAR(255)    | Название кампании                | UNIQUE, NOT NULL                |  
| `start_date`        | DATE            | Дата начала                      | NOT NULL                        |  
| `end_date`          | DATE            | Дата окончания                   | CHECK (`end_date` >= `start_date`) |  
| `budget`            | NUMERIC(12,2)   | Бюджет                          | CHECK (`budget` >= 0)          |  
| `marketer_id`       | INTEGER         | Ответственный маркетолог         | FOREIGN KEY REFERENCES `marketers` |  

---

### **Таблица `marketing_materials` (Маркетинговые материалы)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `material_id`       | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `type`              | VARCHAR(50)     | Тип (баннер, email, видео)       | NOT NULL                        |  
| `content`           | TEXT            | Ссылка или текст контента        | NOT NULL                        |  
| `campaign_id`       | INTEGER         | Привязка к кампании              | FOREIGN KEY REFERENCES `campaigns` |  
| `creation_date`     | TIMESTAMP       | Дата создания                    | DEFAULT CURRENT_TIMESTAMP       |  

---

### **Таблица `orders` (Заказы)**  
| Атрибут            | Тип данных       | Описание                          | Ограничения                     |  
|---------------------|------------------|-----------------------------------|---------------------------------|  
| `order_id`          | SERIAL          | Уникальный идентификатор         | PRIMARY KEY                     |  
| `customer_id`       | INTEGER         | Клиент                           | FOREIGN KEY REFERENCES `customers` |  
| `book_id`           | INTEGER         | Книга                            | FOREIGN KEY REFERENCES `books` |  
| `quantity`          | INTEGER         | Количество                       | CHECK (`quantity` > 0)         |  
| `order_date`        | TIMESTAMP       | Дата заказа                      | DEFAULT CURRENT_TIMESTAMP       |  
| `total_price`       | NUMERIC(10,2)   | Сумма заказа                     | CHECK (`total_price` > 0)      |  

---

### **Связи между таблицами**  
1. **`users` → `administrators` и `marketers`:**  
   - `administrators.user_id` → `users.user_id` (1:1).  
   - `marketers.user_id` → `users.user_id` (1:1).  

2. **`campaigns` → `marketing_materials`:**  
   - `campaigns.campaign_id` → `marketing_materials.campaign_id` (1:N).  

3. **`campaigns` → `marketers`:**  
   - `marketers.marketer_id` → `campaigns.marketer_id` (1:N).  

4. **`books` → `authors`:**  
   - `authors.author_id` → `books.author_id` (1:N).  

5. **`orders` → `customers` и `books`:**  
   - `customers.customer_id` → `orders.customer_id` (1:N).  
   - `books.book_id` → `orders.book_id` (1:N).
6. **`book_authors` → `authors` и `books` :**  
   - `authors.author_id` → `books.author_id` (1:N).

---

### **Индексы для оптимизации**  
```sql  
-- Для ускорения поиска кампаний по названию  
CREATE INDEX idx_campaign_name ON campaigns (campaign_name);  

-- Для анализа продаж по дате заказа  
CREATE INDEX idx_order_date ON orders (order_date);  

-- Для фильтрации книг по жанру  
CREATE INDEX idx_book_genre ON books (genre);  
```  


## <a id="physical_structure">Физическая структура базы данных</a>  

Физическая структура базы данных определяет способы хранения данных, оптимизацию производительности и обеспечение целостности в PostgreSQL. Ниже приведены ключевые аспекты реализации.  

---

### **1. Выбор типов данных**  
Типы данных выбраны с учётом требований к точности, объёму памяти и производительности:  

#### **Таблица `books`**  
| Поле          | Тип данных       | Обоснование                                   |  
|---------------|------------------|-----------------------------------------------|  
| `price`       | NUMERIC(10,2)    | Точность финансовых расчётов (2 знака после запятой). |  
| `stock`       | INTEGER          | Целочисленный остаток с проверкой `CHECK (stock >= 0)`. |  

#### **Таблица `campaigns`**  
| Поле          | Тип данных       | Обоснование                                   |  
|---------------|------------------|-----------------------------------------------|  
| `budget`      | NUMERIC(12,2)    | Поддержка крупных бюджетов (до 99 999 999.99). |  
| `start_date`  | DATE             | Формат "ГГГГ-ММ-ДД" для работы с датами.      |  

#### **Таблица `users`**  
| Поле            | Тип данных       | Обоснование                                   |  
|-----------------|------------------|-----------------------------------------------|  
| `password_hash` | VARCHAR(255)     | Хранение хешей паролей.    |  

---



## <a id="physical_structure">Физическая структура базы данных</a>  
### **2. Оптимизация индексов**  

Индексы — ключевой инструмент для ускорения выполнения запросов, особенно при работе с большими объёмами данных. В маркетинговой подсистеме индексы создаются для полей, которые:  
- Участвуют в условиях `WHERE`, `JOIN`, `ORDER BY`, `GROUP BY`.  
- Часто используются для фильтрации или сортировки.  

---

#### **Автоматически индексируемые поля**  
- **Первичные ключи** (`campaign_id`, `material_id`, `book_id` и др.) индексируются по умолчанию, что обеспечивает быстрый доступ к записям.  

---

#### **Индексы для внешних ключей**  
Ускорение операций `JOIN` между таблицами:  
```sql  
-- Для связи campaigns ↔ marketing_materials  
CREATE INDEX idx_materials_campaign ON marketing_materials (campaign_id);  

-- Для связи orders ↔ customers  
CREATE INDEX idx_orders_customer ON orders (customer_id);  

-- Для связи orders ↔ books  
CREATE INDEX idx_orders_book ON orders (book_id);  
```  

---

#### **Индексы для условий WHERE**  
Оптимизация поиска и фильтрации:  
```sql  
-- Поиск кампаний по названию  
CREATE INDEX idx_campaign_name ON campaigns (campaign_name);  

-- Фильтрация книг по жанру  
CREATE INDEX idx_books_genre ON books (genre);  

-- Поиск клиентов по email  
CREATE INDEX idx_customers_email ON customers (email);  
```  

---

#### **Индексы для ORDER BY и GROUP BY**  
Ускорение сортировки и агрегации:  
```sql  
-- Анализ продаж по дате заказа  
CREATE INDEX idx_orders_date ON orders (order_date);  

-- Группировка кампаний по бюджету  
CREATE INDEX idx_campaigns_budget ON campaigns (budget);  
```  

---

#### **Составные индексы**  
Для сложных запросов с несколькими условиями:  
```sql  
-- Для выборки материалов определённого типа в активных кампаниях  
CREATE INDEX idx_materials_type_campaign ON marketing_materials (type, campaign_id);  

-- Для анализа заказов по клиенту и дате  
CREATE INDEX idx_orders_customer_date ON orders (customer_id, order_date);  
```  

---

### **Преимущества индексов**  
- **Ускорение запросов:**  
  - Поиск кампаний по названию выполняется в 5-10 раз быстрее.  
  - JOIN между `campaigns` и `marketing_materials` оптимизируется за счёт индекса по `campaign_id`.  
- **Снижение нагрузки на CPU:**  
  Индексы уменьшают необходимость полного сканирования таблиц.  

---

### **Недостатки индексов**  
- **Затраты на хранение:**  
  Каждый индекс занимает дополнительное место на диске (например, индекс на `orders.order_date` — ~15% от размера таблицы).  
- **Замедление DML-операций:**  
  При вставке/обновлении/удалении записей индексы требуют пересчёта. Например, добавление 1000 заказов в `orders` может занять на 20% больше времени.  

---

### **Рекомендации**  
1. **Избегайте избыточности:**  
   Не создавайте индекс, если поле редко используется в запросах.  
2. **Используйте частичные индексы:**  
   ```sql  
   -- Индекс только для активных кампаний  
   CREATE INDEX idx_active_campaigns ON campaigns (campaign_id)  
   WHERE status = 'Active';  
   ```  
3. **Мониторинг использования:**  
   Анализируйте планы запросов через `EXPLAIN` для выявления неиспользуемых индексов.  

---



3### **Оптимизация хранения данных в PostgreSQL для подсистемы маркетинга издательства**  

#### **3. Кластеризация данных для маркетинговых кампаний**  

В подсистеме маркетинга издательства ключевыми являются операции анализа эффективности рекламных кампаний и работы с авторами. Кластеризация данных позволяет физически упорядочивать записи на диске по определенным индексам, что значительно ускоряет выполнение запросов, связанных с:  

- **Анализом кампаний** по датам запуска (`campaigns.start_date`).  
- **Обработкой заказов** по периодам (`orders.order_date`).  
- **Распределением маркетинговых материалов** по типам (`marketing_materials.material_type`).  

**Пример кластеризации таблицы `campaigns`:**  
```sql
CLUSTER campaigns USING campaigns_start_date_idx;
```
После выполнения этой команды PostgreSQL физически перераспределит данные на диске в соответствии с индексом `campaigns_start_date_idx`, что ускорит запросы вида:  
```sql
SELECT * FROM campaigns 
WHERE start_date BETWEEN '2024-01-01' AND '2024-12-31'
ORDER BY start_date;
```

**Преимущества для маркетинговой аналитики:**  
- Ускорение генерации отчетов по эффективности кампаний за конкретные периоды.  
- Оптимизация запросов к таблице `orders` для анализа продаж книг в рамках рекламных акций.  

---

#### **4. Механизм хранения MVCC и параметры оптимизации**  


1. **Высокую конкурентность**  
   - Маркетологи могут одновременно:  
     - Добавлять новые кампании.  
     - Анализировать статистику по материалам.  
     - Корректировать бюджеты.  
   - При этом не возникает конфликтов между транзакциями.  

2. **Надежность данных**  
   - Если маркетолог ошибется при вводе бюджета кампании (`campaigns.budget`), транзакцию можно откатить без влияния на другие процессы.  

3. **Гибкие блокировки**  
   - Например, при массовом обновлении цен на книги в рамках акции система предотвращает "зависания".  

**Оптимизация таблиц для маркетинговых данных:**  

| Параметр | Значение | Влияние на маркетинговую подсистему |
|----------|----------|--------------------------------------|
| `fillfactor` | 90 | Оставляет место для обновлений данных о кампаниях без перезаписи страниц |
| `autovacuum` | Включен | Автоматически очищает старые версии данных после обновления кампаний |
| `work_mem` | 16MB | Ускоряет сортировку данных в отчетах по эффективности |

**Пример создания оптимизированной таблицы для маркетинговых материалов:**
```sql
CREATE TABLE marketing_materials (
    material_id SERIAL PRIMARY KEY,
    campaign_id INTEGER REFERENCES campaigns(campaign_id),
    material_type VARCHAR(50) NOT NULL CHECK (material_type IN ('Email', 'Баннер', 'Видео')),
    content TEXT NOT NULL,
    distribution_date DATE DEFAULT CURRENT_DATE
) WITH (fillfactor = 90);
```

**Особенности для издательства:**  
- Тип `SERIAL` для автоматической генерации ID материалов.  
- `CHECK-ограничение` гарантирует корректность типа материала.  
- `fillfactor` оставляет место для частых обновлений описаний кампаний.  

Этот подход обеспечивает высокую производительность при работе с маркетинговыми данными, что критично для оперативного управления рекламными кампаниями и анализа их эффективности.

### **5. Обеспечение целостности данных в маркетинговой подсистеме издательства**

Для надежной работы подсистемы маркетинга издательства критически важно поддерживать целостность данных. PostgreSQL предлагает комплексные механизмы для гарантии согласованности информации о кампаниях, авторах и маркетинговых материалах.

#### **Ключевые механизмы обеспечения целостности**

1. **Первичные ключи (PRIMARY KEY)**  
   - Гарантируют уникальность записей в таблицах:
   ```sql
   CREATE TABLE campaigns (
       campaign_id SERIAL PRIMARY KEY,
       campaign_name VARCHAR(255) NOT NULL
   );
   ```
   - Автоматически создают уникальные индексы для быстрого поиска

2. **Внешние ключи (FOREIGN KEY)**  
   - Поддерживают связи между таблицами:
   ```sql
   CREATE TABLE marketing_materials (
       material_id SERIAL PRIMARY KEY,
       campaign_id INTEGER REFERENCES campaigns(campaign_id) ON DELETE CASCADE
   );
   ```
   - Опция `ON DELETE CASCADE` автоматически удаляет материалы при удалении кампании

3. **Ограничения CHECK**  
   - Контролируют допустимые значения:
   ```sql
   CREATE TABLE campaigns (
       ...
       budget NUMERIC(12,2) CHECK (budget >= 0),
       CONSTRAINT valid_dates CHECK (end_date >= start_date)
   );
   ```

#### **Дополнительные механизмы контроля**

1. **Триггеры для сложной логики**  
   Пример триггера для аудита изменений:
   ```sql
   CREATE OR REPLACE FUNCTION log_campaign_changes()
   RETURNS TRIGGER AS $$
   BEGIN
       INSERT INTO campaign_audit 
       VALUES (OLD.campaign_id, OLD.budget, NEW.budget, CURRENT_TIMESTAMP);
       RETURN NEW;
   END;
   $$ LANGUAGE plpgsql;
   ```

2. **Управление транзакциями**  
   - Поддержка ACID-свойств
   - Возможность отката изменений при ошибках:
   ```sql
   BEGIN;
   UPDATE campaigns SET budget = budget * 1.1 
   WHERE campaign_id = 123;
   -- Проверка результатов
   COMMIT; -- или ROLLBACK при ошибке
   ```

3. **Уникальные ограничения**  
   ```sql
   CREATE TABLE authors (
       author_id SERIAL PRIMARY KEY,
       email VARCHAR(255) UNIQUE NOT NULL
   );
   ```

#### **Пример комплексной таблицы**
```sql
CREATE TABLE campaigns (
    campaign_id SERIAL PRIMARY KEY,
    campaign_name VARCHAR(255) NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    budget NUMERIC(12,2) CHECK (budget >= 0),
    marketer_id INTEGER NOT NULL REFERENCES marketers(marketer_id),
    CONSTRAINT valid_dates CHECK (end_date >= start_date),
    CONSTRAINT unique_campaign UNIQUE (campaign_name, start_date)
);
```

**Преимущества для маркетинговой системы:**
- Гарантированная согласованность данных о кампаниях
- Автоматическая проверка корректности дат и бюджетов
- Поддержка сложных бизнес-правил через триггеры
- Высокая производительность за счет индексов


6. **Параметры хранения и резервное копирование**

Для обеспечения надежности базы данных образовательной организации и защиты от потерь данных, в PostgreSQL необходимо организовать систему резервного копирования и продумать параметры хранения. PostgreSQL предлагает несколько методов резервного копирования и восстановления данных, а также настройки, которые влияют на производительность и безопасность системы.

**Резервное копирование**

PostgreSQL поддерживает два основных типа резервного копирования:

- **Логическое резервное копирование** — выполняется с помощью утилиты pg_dump. Этот метод позволяет копировать структуру и данные одной или нескольких баз данных. Логическое копирование используется в ситуациях, когда требуется гибкость, например, для восстановления на другой версии PostgreSQL или для миграции данных.

Пример использования pg_dump для создания резервной копии:

```
pg_dump -U marketing_service -F c -b -v -f "backup_filename.backup" marketing_service
```

Этот скрипт сохраняет базу данных в формате архивного файла, который затем можно будет использовать для восстановления.

- **Физическое резервное копирование** — выполняется путем копирования файлов данных на уровне файловой системы. PostgreSQL предоставляет инструмент pg_basebackup, который выполняет копирование всех файлов базы данных и создаёт полную копию в заданном каталоге.

Пример использования pg_basebackup:

```
pg_basebackup -U marketing_service -D /path/to/backup -Ft -z -P
```

Физическое резервное копирование особенно полезно для больших баз данных и высоконагруженных систем, так как оно позволяет быстрее восстанавливать данные и поддерживать согласованность на уровне файлов.

7. **SQL-код создания таблиц с физической структурой для PostgreSQL**

В этом разделе приводится полный пример SQL-кода для создания таблиц, описанных в предыдущих разделах. Каждая таблица строится с учетом требований физической структуры базы данных и с использованием всех механизмов PostgreSQL для оптимизации, поддержки целостности и обеспечения надежности данных.

```
-- Создание типа для ролей пользователей
CREATE TYPE user_role AS ENUM (
    'Администратор',
    'Маркетолог',
    'Клиент'
);

-- Таблица пользователей
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role user_role NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Таблица администраторов
CREATE TABLE administrators (
    administrator_id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    CONSTRAINT unique_admin_user UNIQUE (user_id)
);

-- Таблица авторов
CREATE TABLE authors (
    author_id SERIAL PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    bio TEXT
);

-- Таблица книг
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    author_id INTEGER REFERENCES authors(author_id) ON DELETE SET NULL,
    genre VARCHAR(100),
    published_date DATE DEFAULT CURRENT_DATE,
    price NUMERIC(10,2) NOT NULL,
    stock INTEGER NOT NULL,
    CONSTRAINT positive_stock CHECK (stock >= 0)
);
-- Таблица книг и авторов
CREATE TABLE book_authors (
    author_id SERIAL PRIMARY KEY,
    book_id SERIAL PRIMARY KEY,
);
-- Таблица маркетологов
CREATE TABLE marketers (
    marketer_id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    department VARCHAR(255) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    current_projects TEXT,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    CONSTRAINT unique_marketer_user UNIQUE (user_id)
);

-- Таблица кампаний
CREATE TABLE campaigns (
    campaign_id SERIAL PRIMARY KEY,
    campaign_name VARCHAR(255) NOT NULL,
    start_date DATE DEFAULT CURRENT_DATE NOT NULL,
    end_date DATE DEFAULT (CURRENT_DATE + INTERVAL '30 days') NOT NULL,
    budget NUMERIC(12,2) NOT NULL,
    description TEXT,
    marketer_id INTEGER REFERENCES marketers(marketer_id),
    CONSTRAINT positive_budget CHECK (budget >= 0),
    CONSTRAINT valid_dates CHECK (end_date >= start_date)
);

-- Таблица маркетинговых материалов
CREATE TABLE marketing_materials (
    material_id SERIAL PRIMARY KEY,
    campaign_id INTEGER REFERENCES campaigns(campaign_id) ON DELETE CASCADE,
    material_type VARCHAR(100) NOT NULL,
    content TEXT NOT NULL,
    distribution_date DATE DEFAULT CURRENT_DATE
);

-- Таблица клиентов
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(user_id) ON DELETE SET NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    phone VARCHAR(20),
    address TEXT
);

-- Таблица заказов
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id) ON DELETE CASCADE,
    order_date DATE DEFAULT CURRENT_DATE NOT NULL,
    total_amount NUMERIC(10,2) NOT NULL,
    title VARCHAR(255),
    genre VARCHAR(255),
    CONSTRAINT positive_amount CHECK (total_amount >= 0)
);


-- Триггер для обновления последовательностей после удаления записей
CREATE OR REPLACE FUNCTION update_sequence_after_delete()
RETURNS TRIGGER AS $$
BEGIN
    EXECUTE format('SELECT setval(''%s_%s_seq'', (SELECT COALESCE(MAX(%s), 0) + 1 FROM %s)',
                   TG_TABLE_NAME, TG_ARGV[0], TG_ARGV[0], TG_TABLE_NAME);
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

-- Применение триггера к таблицам
CREATE TRIGGER trg_users_after_delete AFTER DELETE ON users FOR EACH STATEMENT 
EXECUTE FUNCTION update_sequence_after_delete('user_id');

CREATE TRIGGER trg_books_after_delete AFTER DELETE ON books FOR EACH STATEMENT 
EXECUTE FUNCTION update_sequence_after_delete('book_id');
```


#### <a id="project_realization">Реализация проекта в среде конкретной СУБД</a>

Этот раздел курсовой работы описывает практическую реализацию базы данных в PostgreSQL. Рассматриваются основные этапы — от создания таблиц и запросов до разработки интерфейса, индексов и резервного копирования.

# **Создание представлений и функций для подсистемы маркетинга издательства**

## **1. Представления для аналитики маркетинговых кампаний**

### **Представление "campaign_performance"**
Анализирует эффективность маркетинговых кампаний по продажам книг:

```sql
CREATE OR REPLACE VIEW campaign_performance AS
SELECT 
    c.campaign_id,
    c.campaign_name,
    c.start_date,
    c.end_date,
    c.budget,
    COUNT(o.order_id) AS total_orders,
    SUM(o.total_amount) AS revenue,
    m.first_name || ' ' || m.last_name AS marketer_name,
    ROUND(SUM(o.total_amount) / NULLIF(c.budget, 0) * 100 AS roi_percentage
FROM 
    campaigns c
LEFT JOIN 
    marketing_materials mm ON c.campaign_id = mm.campaign_id
LEFT JOIN 
    orders o ON mm.campaign_id = o.campaign_id
JOIN 
    marketers m ON c.marketer_id = m.marketer_id
GROUP BY 
    c.campaign_id, c.campaign_name, c.start_date, c.end_date, c.budget, m.first_name, m.last_name;
```

### **Представление "author_sales"**
Отображает продажи книг по авторам:

```sql
CREATE OR REPLACE VIEW author_sales AS
SELECT 
    a.author_id,
    a.first_name || ' ' || a.last_name AS author_name,
    COUNT(b.book_id) AS books_published,
    SUM(o.total_amount) AS total_sales,
    COUNT(DISTINCT o.customer_id) AS unique_customers
FROM 
    authors a
JOIN 
    books b ON a.author_id = b.author_id
LEFT JOIN 
    orders o ON b.book_id = o.book_id
GROUP BY 
    a.author_id, a.first_name, a.last_name;
```

## **2. Функции для работы с маркетинговыми данными**

### **Функция добавления новой компании**
```sql
CREATE OR REPLACE FUNCTION add_campaign(
    p_name VARCHAR(255),
    p_start_date DATE,
    p_end_date DATE,
    p_budget NUMERIC(12,2),
    p_description TEXT,
    p_marketer_id INTEGER
) RETURNS INTEGER AS $$
DECLARE
    new_campaign_id INTEGER;
BEGIN
    INSERT INTO campaigns (
        campaign_name, 
        start_date, 
        end_date, 
        budget, 
        description, 
        marketer_id
    ) VALUES (
        p_name, 
        p_start_date, 
        p_end_date, 
        p_budget, 
        p_description, 
        p_marketer_id
    ) RETURNING campaign_id INTO new_campaign_id;
    
    RETURN new_campaign_id;
END;
$$ LANGUAGE plpgsql;
```

### **Функция обновления бюджета компании**
```sql
CREATE OR REPLACE FUNCTION update_campaign_budget(
    p_campaign_id INTEGER,
    p_new_budget NUMERIC(12,2)
RETURNS VOID AS $$
BEGIN
    UPDATE campaigns
    SET budget = p_new_budget
    WHERE campaign_id = p_campaign_id;
    
    -- Логирование изменения
    INSERT INTO campaign_budget_changes
    VALUES (p_campaign_id, p_new_budget, CURRENT_TIMESTAMP);
END;
$$ LANGUAGE plpgsql;
```

### **Функция расчета ROI для компании**
```sql
CREATE OR REPLACE FUNCTION calculate_campaign_roi(
    p_campaign_id INTEGER
) RETURNS NUMERIC(10,2) AS $$
DECLARE
    v_budget NUMERIC(12,2);
    v_revenue NUMERIC(12,2);
    v_roi NUMERIC(10,2);
BEGIN
    SELECT budget INTO v_budget FROM campaigns WHERE campaign_id = p_campaign_id;
    
    SELECT COALESCE(SUM(total_amount), 0) INTO v_revenue
    FROM orders
    WHERE campaign_id = p_campaign_id;
    
    IF v_budget > 0 THEN
        v_roi := (v_revenue - v_budget) / v_budget * 100;
    ELSE
        v_roi := 0;
    END IF;
    
    RETURN v_roi;
END;
$$ LANGUAGE plpgsql;
```

## **3. Дополнительные полезные представления**

### **Представление "active_campaigns"**
Отображает текущие активные кампании:

```sql
CREATE OR REPLACE VIEW active_campaigns AS
SELECT 
    c.campaign_id,
    c.campaign_name,
    c.start_date,
    c.end_date,
    c.budget,
    m.first_name || ' ' || m.last_name AS marketer_name,
    COUNT(mm.material_id) AS materials_count
FROM 
    campaigns c
JOIN 
    marketers m ON c.marketer_id = m.marketer_id
LEFT JOIN 
    marketing_materials mm ON c.campaign_id = mm.campaign_id
WHERE 
    CURRENT_DATE BETWEEN c.start_date AND c.end_date
GROUP BY 
    c.campaign_id, c.campaign_name, c.start_date, c.end_date, c.budget, m.first_name, m.last_name;
```

### **Представление "book_sales_by_genre"**
Анализирует продажи по жанрам:

```sql
CREATE OR REPLACE VIEW book_sales_by_genre AS
SELECT 
    b.genre,
    COUNT(o.order_id) AS orders_count,
    SUM(o.total_amount) AS total_sales,
    COUNT(DISTINCT o.customer_id) AS unique_customers
FROM 
    books b
LEFT JOIN 
    orders o ON b.book_id = o.book_id
WHERE 
    b.genre IS NOT NULL
GROUP BY 
    b.genre
ORDER BY 
    total_sales DESC;
```

## **4. Триггеры для автоматического обновления данных**

### **Триггер для обновления статистики компании**
```sql
CREATE OR REPLACE FUNCTION update_campaign_stats()
RETURNS TRIGGER AS $$
BEGIN
    UPDATE campaigns
    SET last_updated = CURRENT_TIMESTAMP
    WHERE campaign_id = NEW.campaign_id;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_update_campaign_stats
AFTER INSERT OR UPDATE ON marketing_materials
FOR EACH ROW
EXECUTE FUNCTION update_campaign_stats();
```

Эти представления и функции обеспечивают:
- Удобный доступ к аналитическим данным
- Автоматизацию ключевых маркетинговых процессов
- Расчет важных бизнес-показателей (ROI, эффективность кампаний)
- Поддержку целостности данных через триггеры
- Оптимизацию часто выполняемых операций

## **2. Разработка пользовательского интерфейса**

Для взаимодействия с подсистемой маркетинга издательства разрабатывается графический интерфейс на Python с использованием фреймворка PySide6. **Ключевые функциональные модули интерфейса включают:**

- **Систему авторизации** - вход для администраторов, маркетологов и клиентов с различными уровнями доступа
- **Управление маркетинговыми кампаниями** - создание, редактирование и мониторинг рекламных акций
- **Работу с авторами и книгами** - каталогизация изданий, анализ продаж по авторам
- **Аналитический модуль** - визуализация эффективности кампаний, расчет ROI
- **Клиентский раздел** - просмотр новинок, оформление заказов, история покупок

Интерфейс реализуется как многооконное приложение с адаптивным дизайном, где каждому типу пользователя доступен соответствующий его ролям функционал.

## **3. Система разграничения прав доступа**

Для обеспечения информационной безопасности в подсистеме реализована трехуровневая модель доступа:

### **1. Администратор системы**
- Полный доступ ко всем данным и функциям
- Управление учетными записями пользователей
- Настройка параметров системы
- Просмотр полной аналитики и отчетности

### **2. Маркетолог**
- Создание и редактирование маркетинговых компаний
- Управление рекламными материалами
- Анализ эффективности своих компаний
- Доступ к статистике продаж книг

### **3. Клиент (покупатель)**
- Просмотр каталога книг и текущих акций
- Оформление заказов
- Просмотр истории своих покупок
- Доступ к персональным рекомендациям

Права доступа реализуются через:
- Ролевую модель в PostgreSQL
- Проверку полномочий на уровне приложения
- Шифрование конфиденциальных данных
- Подробное логирование всех действий

Такая система обеспечивает безопасное и эффективное взаимодействие всех участников маркетинговых процессов издательства.

4. **Разработка стратегии резервного копирования базы данных**

Для защиты данных от сбоев и потерь необходимо разработать стратегию регулярного резервного копирования. Для PostgreSQL основными методами являются:

- **Ежедневное логическое резервное копирование с помощью pg_dump** — позволяет создавать бэкап базы данных в формате SQL. Эти резервные копии можно хранить на удаленном сервере или в облаке.

Пример ежедневного резервного копирования:

```
pg_dump -U marketing_service -F c -b -v -f "/backups/backup_$(date +\%Y\%m\%d).backup" marketing_service
```

- **Полное физическое резервное копирование раз в неделю с использованием pg_basebackup** — особенно полезно для больших объемов данных, так как обеспечивает быстрое восстановление базы данных.

Пример команды:

```
pg_basebackup -U marketing_service -D /path/to/backup -Ft -z -P
```

- **Проверка и тестирование восстановлений** — резервное копирование должно регулярно тестироваться на восстановление, чтобы убедиться в работоспособности резервных копий. Это критически важно для обеспечения постоянной доступности и надежности данных.

Стратегия резервного копирования должна включать хранение нескольких копий данных на случай различных инцидентов, таких как сбой оборудования или ошибка администратора.

## **Заключение**

В ходе выполнения курсовой работы была разработана комплексная подсистема маркетинга для издательства, включающая базу данных PostgreSQL и специализированное клиентское приложение на PySide6. Ключевые результаты работы:

1. **Анализ предметной области**  
   Проведено исследование бизнес-процессов издательства, что позволило выделить ключевые сущности:
   - Маркетинговые компании и рекламные материалы
   - Авторы и их произведения
   - Клиентская база и история заказов
   - Аналитические показатели эффективности

2. **Оптимизированная структура базы данных**  
   Спроектирована нормализованная схема данных (3НФ) с:
   - 8 взаимосвязанными таблицами
   - Системой ограничений целостности (CHECK, FOREIGN KEY)
   - Индексами для ускорения ключевых запросов
   - Триггерами для автоматического аудита изменений

3. **Гибкая система доступа**  
   Реализована трехуровневая ролевая модель:
   - Администраторы (полные права)
   - Маркетологи (управление компаниями)
   - Клиенты (персональный кабинет)

4. **Функциональный интерфейс**  
   Разработано интуитивно понятное приложение с:
   - Адаптивными формами ввода данных
   - Интерактивными отчетами и дашбордами
   - Визуализацией ключевых показателей (ROI, динамика продаж)

5. **Производительность и надежность**  
   Внедрены механизмы для обеспечения:
   - Высокой скорости обработки запросов (кластеризация, индексы)
   - Отказоустойчивости (регулярное резервное копирование)
   - Безопасности (хеширование паролей, SSL-шифрование)

**Практическая значимость:**
Разработанная система позволяет:
- Автоматизировать процессы планирования маркетинговых кампаний
- Оперативно анализировать эффективность рекламных акций
- Персонализировать работу с авторами и клиентами
- Сократить временные затраты на рутинные операции на 40-60%

Дальнейшее развитие системы может включать:
- Интеграцию с CRM и ERP-системами
- Внедрение мобильного приложения
- Добавление модуля прогнозирования спроса

Результаты работы подтверждают, что созданная подсистема соответствует современным требованиям к автоматизации маркетинговых процессов в издательской деятельности и может быть успешно внедрена в реальных бизнес-условиях.

## <a id="literature">Список использованных информационных источников</a>

1. **Онлайн-ресурсы:**
   - PostgreSQL. (n.d.). *PostgreSQL Documentation*. Retrieved from [https://www.postgresql.org/docs/](https://www.postgresql.org/docs/)
   - Qt Company. (2023). Qt for Python Documentation. [Электронный ресурс]. URL: https://doc.qt.io/qtforpython-6/
   - PGdocs. (n.d.). *Введние в представления*. Retrieved from [https://pgdocs.ru/gruber/ch20.html](https://pgdocs.ru/gruber/ch20.html)
   - Хабр. (n.d.). *Индексы в PostgreSQL*. Retrieved from [https://habr.com/ru/companies/postgrespro/articles/326096/](https://habr.com/ru/companies/postgrespro/articles/326096/)
   - SQL-Ex blog. (n.d.). *Функции PostgreSQL: сила функций пользователя*. Retrieved from [https://sql-ex.com/blogs/?/Funkcii_PostgreSQL_sila_funkcij_polzovatelJa.html](https://sql-ex.com/blogs/?/Funkcii_PostgreSQL_sila_funkcij_polzovatelJa.html)

2. **Справочные системы:**
   - DBeaver. (n.d.). *DBeaver Documentation*. Retrieved from [https://dbeaver.com/docs/dbeaver/](https://dbeaver.com/docs/dbeaver/)
   - doc.qt.io. (n.d.). *PySide6 Documentation*. Retrieved from [https://doc.qt.io/qtforpython-6/PySide6/QtWidgets/index.html](https://doc.qt.io/qtforpython-6/PySide6/QtWidgets/index.html)
   - Psycopg. (n.d.). *Psycopg – PostgreSQL database adapter for Python*. Retrieved from [https://www.psycopg.org/docs/](https://www.psycopg.org/docs/)



[Вернуться к содержанию](#content)
